<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Guess bear type</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <style>
    #div-bear-type {
      font-family: sans-serif;
      font-size: 1.1em;
      line-height: 30px;
    }

    #div-image-output {
      max-width: 800px;
      text-align: center;
    }

    #img-output {
      max-width: 800px;
    }
  </style>

  <script>

    document.addEventListener('DOMContentLoaded', () => {

      const btn = document.getElementById('button-submit');
      const inputImageUrl = document.getElementById('image-url');
      const imgOutput = document.getElementById('img-output');
      const bearTypeOutput = document.getElementById('div-bear-type');

      btn.addEventListener('click', () => submit(inputImageUrl.value));

      function submit(value) {
        const http = new XMLHttpRequest()
        http.open('POST', 'https://thiagoh-test.hf.space/display-image')
        http.setRequestHeader('Content-type', 'application/json');
        http.onreadystatechange = function () {//Call a function when the state changes.
          if (http.readyState === XMLHttpRequest.DONE && http.status == 200) {
            console.log(http);
            const data = JSON.parse(http.responseText)
            // imgOutput.src = 'data:image/png;base64,' + data.imageEncodedBytes;
            imgOutput.src = value;
            bearTypeOutput.innerHTML = `Type is ${data.prediction} with confidence ${data.probability}`;
          }
        }
        http.send(JSON.stringify({ imageUrl: value }));
      }
    });

  </script>
</head>

<body class="container">

  <h1>What's the bear?</h1>

  <div id="div-input-fields" class="row">
    <div class="mb-3">
      <label for="exampleInputEmail1" class="form-label">Url</label>
      <input type="url" id="image-url" class="form-control" placeholder="https://example.com/my-image.jpg" />
    </div>
  </div>

  <div class="row">
    <div class="col">
      <input type="button" id="button-submit" class="btn btn-secondary" value="Submit" />
    </div>
  </div>

  <div class="row">
    <div class="row">
      <div id="div-bear-type" class="col"></div>
    </div>
    <div class="row">
      <div id="div-image-output" class="col">
        <img id="img-output" />
      </div>
    </div>
  </div>
</body>

</html>
